---
author: Ray Heberer
date: 2017-06-20
linktitle: Interacting with the Spotify API in R
title: Interacting with the Spotify API in R
tags: ["Spotify", "API", "R", "RStudio", "iXperience"]
highlight: true
---

### Introduction

This week at [iXperience](http://ixperience.co.za/) I have been given the freedom to choose a dataset that interests me and perform some analysis. Given my background in music, Spotify seemed like a good choice.

In this post, I will show how to authorize a [Spotify App](https://developer.spotify.com/my-applications/#!/applications) from within R, in the hope that my many trials and errors will benefit others who could potentially be interested in this rich source of data.

### Spotify Web API Authentication

Having worked with the Twitter API last week (check out "@RobertRealGuy" on my [projects](https://rayheberer.netlify.com/projects/) page), I initially hoped that the Spotify API would be equally tractable in R. Unfortunately, while the Twitter API's OAuth process is basically accomplished in one step using the [twitteR package](https://cran.r-project.org/web/packages/twitteR/twitteR.pdf), Spotify has no packages on CRAN just yet, and I was not successful with the two in-development packages I found on GitHub.

Basically, authenticating a Spotify App and then making requests has two steps, instead of one. First, a token must be extracted from the response generated by the POST request in which the client ID and secret are provided. Then, and this is the important bit, that token must be specified as a header in every subsequent request made to the APIs endpoints. At least, that is my understanding.

Anyways, on to the code. I will be loading up a few libraries that will be used further down this post as well.

```
library(httr)
library(magrittr)
library(rvest)
library(ggplot2)

clientID = "aSIfiwOUlD"
secret = "sH0wTH3sEpUBlicLy"

response = POST(
  'https://accounts.spotify.com/api/token',
  accept_json(),
  authenticate(clientID, secret),
  body = list(grant_type = 'client_credentials'),
  encode = 'form',
  verbose()
)

token = content(response)$access_token

```

Because the authorization header in the requests I will be making using this token have to be of a certain form (having the word "bearer"), I assign some formatted text to a new variable.

```
authorization.header = paste0("Bearer ", token)
```

With this, you should be fully equipped to start interacting with the Spotify API. I hope this has solved some difficulties and answered some questions, and if you'd like to stick around, I'll briefly demonstrate what sort of things are possible with the API.

### Data Wrangling

It's instructive to look through the [list of endpoints](https://developer.spotify.com/web-api/endpoint-reference/) Spotify's Web API gives developers access to. Very quickly, one might notice that having a track's ID is quite essential for many of the requests.

Since I wanted the tracks in my dataset to have some sort of significance, I went to [Spotify Charts](https://spotifycharts.com/regional/global/weekly/latest) to pull the weekly top 200 IDs. Now, extracting these IDs is just an exercise in web scraping, and I will leave my code below.

```
weekly.top.songs = read_html("https://spotifycharts.com/regional/global/weekly/latest") %>%
  html_nodes("#content > div > div > div > span > table > tbody > tr > td.chart-table-image > a")

id.start = regexpr("/track/", weekly.top.songs) # seems to always be 7
id.end = regexpr('" target="', weekly.top.songs) # seems to always be 63

top.song.ids = substr(weekly.top.songs, id.start+7, id.end-1)
```

top.song.ids is a character vector with a length of 200. This is what I will looping through to gather data about these tracks using the Spotify API.

### Making API Requests

